<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sails JS - framework for Nodejs | Backend experience</title>
    <meta name="description" content="Experience from life">
    
    
    <link rel="preload" href="/EXPA--Backend/assets/css/0.styles.2c5e1645.css" as="style"><link rel="preload" href="/EXPA--Backend/assets/js/app.a74ff4a4.js" as="script"><link rel="preload" href="/EXPA--Backend/assets/js/2.3576fb27.js" as="script"><link rel="preload" href="/EXPA--Backend/assets/js/20.45ed8275.js" as="script"><link rel="prefetch" href="/EXPA--Backend/assets/js/10.3af792f0.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/11.e699520b.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/12.e3dc2547.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/13.4bbd216c.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/14.54ace674.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/15.dc414139.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/16.213ac48c.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/17.199a3516.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/18.d0a90063.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/19.92f9f378.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/21.bceebdc2.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/22.853318cd.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/23.c6179a00.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/24.a2662258.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/25.b889264d.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/26.882aa9af.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/27.99400810.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/28.be70d15e.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/29.0f2ea430.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/3.0b7333e5.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/30.003ce03a.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/31.5541885c.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/4.d126b201.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/5.3f166c34.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/6.536f022e.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/7.92531723.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/8.c3474f61.js"><link rel="prefetch" href="/EXPA--Backend/assets/js/9.d0172edf.js">
    <link rel="stylesheet" href="/EXPA--Backend/assets/css/0.styles.2c5e1645.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/EXPA--Backend/" class="home-link router-link-active"><!----> <span class="site-name">Backend experience</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/EXPA--Backend/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/EXPA--Backend/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/EXPA--Backend/node/npm.html" class="sidebar-link">NPM</a></li><li><a href="/EXPA--Backend/node/basic.html" class="sidebar-link">Basic</a></li><li><a href="/EXPA--Backend/node/express-and-ejs.html" class="sidebar-link">Express.js &amp; EJS.js</a></li><li><a href="/EXPA--Backend/node/repl.html" class="sidebar-link">REPL mode</a></li><li><a href="/EXPA--Backend/node/templaters.html" class="sidebar-link">Шаблонизаторы</a></li><li><a href="/EXPA--Backend/node/sockets-io.html" class="sidebar-link">Sockets.io</a></li><li><a href="/EXPA--Backend/node/sails.html" class="active sidebar-link">Sails JS - framework for Nodejs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#комманды-в-консоnе" class="sidebar-link">Комманды в консоле</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#настройки-запуска" class="sidebar-link">Настройки запуска</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#localization" class="sidebar-link">Localization</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#services-иnи-гnобаnьные-функции" class="sidebar-link">Services или Глобальные функции</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#middleware-aka-policies" class="sidebar-link">Middleware (aka Policies)</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#cookies" class="sidebar-link">Cookies</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#подкnючени-к-бд" class="sidebar-link">Подключени к БД</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#шабnонизатор" class="sidebar-link">Шаблонизатор</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#маршруты-config-routes-js" class="sidebar-link">Маршруты (config/routes.js)</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#в-продакшене" class="sidebar-link">В Продакшене</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#request-req" class="sidebar-link">Request(req)</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#promises-db" class="sidebar-link">Promises DB</a></li><li class="sidebar-sub-header"><a href="/EXPA--Backend/node/sails.html#sync-db" class="sidebar-link">Sync DB</a></li></ul></li><li><a href="/EXPA--Backend/node/adonis.html" class="sidebar-link">AdonisJS - framework for Nodejs</a></li><li><a href="/EXPA--Backend/node/int-packages.html" class="sidebar-link">Интересные пакеты</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/EXPA--Backend/c-sharp.html" class="sidebar-link">C#</a></li><li><a href="/EXPA--Backend/cpp.html" class="sidebar-link">C++</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sails-js-framework-for-nodejs"><a href="#sails-js-framework-for-nodejs" aria-hidden="true" class="header-anchor">#</a> Sails JS - framework for Nodejs</h1> <h5 id="useful-links"><a href="#useful-links" aria-hidden="true" class="header-anchor">#</a> Useful links</h5> <ul><li><a href="https://www.youtube.com/watch?v=4ze3RepMRjQ" target="_blank" rel="noopener noreferrer">Tutorial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>http://yoramkornatzky.com/post/localization-of-sails-js-applications</li> <li>http://iantonov.me/page/izuchaem-sailsjs-chast-2-struktura-proekta</li> <li><a href="https://www.youtube.com/watch?v=HrchcED6TKY" target="_blank" rel="noopener noreferrer">Tut 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://next.sailsjs.com/documentation/upgrading/to-v-1-0" target="_blank" rel="noopener noreferrer">Docs of 1.0 vers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="содержание"><a href="#содержание" aria-hidden="true" class="header-anchor">#</a> Содержание</h4> <ul><li><a href="#commands">Комманды в консоле</a></li> <li><a href="#settings">Настройки запуска</a></li> <li><a href="#localization">Localization</a></li> <li><a href="#services">Services</a></li> <li><a href="#middleware">Middleware (aka Policies) - how to use</a></li> <li><a href="#cookies">Cookies</a></li> <li><a href="#db">Подключение к БД</a></li> <li><a href="#templater">Шаблонизатор (EJS)</a></li> <li><a href="#routes">Маршруты</a></li> <li><a href="#prod">В Продакшене</a></li> <li><a href="#req">req(Request)</a></li> <li><a href="#promises_db">Promises DB</a></li> <li><a href="#sync_db">Sync DB</a></li></ul> <hr> <h2 id="комманды-в-консоnе"><a href="#комманды-в-консоnе" aria-hidden="true" class="header-anchor">#</a> Комманды в консоле <a id="commands"></a></h2> <ul><li><strong>sails lift</strong> - поднять сервер Sails</li> <li><strong>sails new MyProject</strong> - создаст проект в папке где находишься</li> <li><strong>sails generate controller page</strong> - создает контроллер PageController.js</li> <li><strong>sails generate api status</strong> - создает StatusController.js(api/controllers) и Status.js(api/models)</li></ul> <h2 id="настройки-запуска"><a href="#настройки-запуска" aria-hidden="true" class="header-anchor">#</a> Настройки запуска <a id="settings"></a></h2> <p>Так можно установить вручную порт и среду запуска</p> <h6 id="app-js"><a href="#app-js" aria-hidden="true" class="header-anchor">#</a> app.js</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dev</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8000</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'dev'</span><span class="token punctuation">;</span>

<span class="token comment">// prod</span>
<span class="token comment">// process.env.PORT = 80;</span>
<span class="token operator">...</span>
</code></pre></div><h2 id="localization"><a href="#localization" aria-hidden="true" class="header-anchor">#</a> Localization <a id="localization"></a></h2> <ul><li>в папке <strong>config/locales</strong> - создаем свой файл где будут переменные ru.json</li> <li>в папке <strong>config/i18n</strong> - расскоментить строку с массивом где языки, и добавить туда свой язык</li> <li>в папке <strong>api/policies</strong> - создаем свой Middleware <strong>localize.js</strong> для перехвата с url версию сайта(ru, de, fr ...)</li> <li>в папке <strong>config</strong> - открыть <strong>policies.js</strong> - и написать свой Middleware**(localize.js)** для всех запросов</li> <li>Используем в шаблоне переменные из файла <strong>ru.json</strong></li> <li>Так же можно писать локализацию прямо в методе</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function-variable function">Index</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    req<span class="token punctuation">.</span><span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token string">'ru'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h5 id="ru-json"><a href="#ru-json" aria-hidden="true" class="header-anchor">#</a> ru.json</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;Welcome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Привед медвед&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;Goodbye&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Покеда.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="routes-js"><a href="#routes-js" aria-hidden="true" class="header-anchor">#</a> routes.js</h5> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token string">'get  /'</span><span class="token punctuation">:</span>             <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/en/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token string">'get  /:lang'</span><span class="token punctuation">:</span>        <span class="token string">'UserController.Index'</span><span class="token punctuation">,</span>
 <span class="token string">'post /:lang/user/'</span><span class="token punctuation">:</span>  <span class="token string">'UserController.addUser'</span><span class="token punctuation">,</span>
</code></pre></div><h5 id="i18n-js"><a href="#i18n-js" aria-hidden="true" class="header-anchor">#</a> i18n.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>i18n <span class="token operator">=</span> <span class="token punctuation">{</span>
     locales<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token string">'es'</span><span class="token punctuation">,</span> <span class="token string">'fr'</span><span class="token punctuation">,</span> <span class="token string">'de'</span><span class="token punctuation">,</span> <span class="token string">'ru'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="localize-js"><a href="#localize-js" aria-hidden="true" class="header-anchor">#</a> localize.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token keyword">var</span> lang <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">'lang'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// перехват переменной из URL</span>
   req<span class="token punctuation">.</span><span class="token function">setLocale</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// установка локализации</span>
   <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="policies-js"><a href="#policies-js" aria-hidden="true" class="header-anchor">#</a> policies.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>policies <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'*'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">'*'</span><span class="token punctuation">:</span> <span class="token string">'localize'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><h5 id="index-ejs"><a href="#index-ejs" aria-hidden="true" class="header-anchor">#</a> index.ejs</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">%=</span> <span class="token function">__</span><span class="token punctuation">(</span><span class="token string">'Welcome'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
</code></pre></div><h2 id="services-иnи-гnобаnьные-функции"><a href="#services-иnи-гnобаnьные-функции" aria-hidden="true" class="header-anchor">#</a> Services или Глобальные функции <a id="services "></a></h2> <p><strong>Сервысы могут хранить переменные их состояние между страницами, как State store</strong></p> <ul><li>Создаем в <strong>api/services</strong> наш сервисес - <strong>myService.js</strong></li> <li>Там можно написать любые функции и экпоритровать их</li> <li>В любом месте можно вызвать функции из Сервиса <strong>(myService.js)</strong></li></ul> <h5 id="myservice-js"><a href="#myservice-js" aria-hidden="true" class="header-anchor">#</a> myService.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>one <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">Summ</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>two <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">Summ</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b <span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="mycontroller-js"><a href="#mycontroller-js" aria-hidden="true" class="header-anchor">#</a> myController.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">Index</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myService<span class="token punctuation">.</span>one<span class="token punctuation">.</span><span class="token function">Summ</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="middleware-aka-policies"><a href="#middleware-aka-policies" aria-hidden="true" class="header-anchor">#</a> Middleware (aka Policies) <a id="middleware"></a></h2> <ul><li>Создать в папке api/policies - myAuth.js</li> <li>Расскоментить в config/policies.js - '*':true;</li> <li>И дописать там же свой контроллер и свой Middleware - 'MyController': { '*': 'myAuth' }</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// config/policies.js</span>

<span class="token comment">// Работа с MIDDLEWARE такая :</span>

  <span class="token comment">// наш Middleware на отдельный контроллер на отдельную функцию</span>
  <span class="token string">'BreedController'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token string">'Index'</span><span class="token punctuation">:</span> <span class="token string">'myAuth'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// наш Middleware на отдельный контроллер на все функции</span>
  <span class="token string">'BreedController'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token string">'*'</span><span class="token punctuation">:</span> <span class="token string">'myAuth'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// наш Middleware - на все контроллеры</span>
  <span class="token string">'*'</span><span class="token punctuation">:</span> <span class="token string">'myAuth'</span> <span class="token punctuation">,</span>
</code></pre></div><p>Также можно писать в routes.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token string">'get  /:lang'</span><span class="token punctuation">:</span>    <span class="token punctuation">[</span> <span class="token punctuation">{</span>policy<span class="token punctuation">:</span> <span class="token string">'myAuth'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>controller<span class="token punctuation">:</span><span class="token string">'UserController'</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span><span class="token string">'Index'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="cookies"><a href="#cookies" aria-hidden="true" class="header-anchor">#</a> Cookies <a id="cookies"></a></h2> <p>примерна такая же и в Laravel</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token function-variable function">Index</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{</span>   
       <span class="token comment">// syntax - res.cookie(name, value, options) </span>
       <span class="token comment">// options:</span>
       <span class="token comment">// maxAge - жизнь куки в милисекундах (значение &quot;-1&quot; убивает куку) </span>
      <span class="token comment">// httpOnly - true or false or nothing</span>
      <span class="token comment">// expires - поставить дату истечения </span>
      <span class="token comment">// path - '/somepath'</span>
      <span class="token comment">// secure - true or nothing - Пометка что кука безопасна (Нафига не понятно)</span>
      <span class="token comment">// domain - .example.com</span>
                       
	    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		  date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span> <span class="token number">7</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//дни</span>

		  res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'rememberme'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>dude<span class="token punctuation">:</span> <span class="token string">'man'</span><span class="token punctuation">,</span> brick<span class="token punctuation">:</span> <span class="token string">'shit'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token punctuation">:</span> date<span class="token punctuation">}</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'Uid'</span><span class="token punctuation">,</span> <span class="token string">'52'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token punctuation">:</span> date <span class="token punctuation">}</span><span class="token punctuation">)</span>
		  res<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">'Cooks were done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
         
 	 <span class="token function-variable function">Kill</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span>
				 <span class="token punctuation">{</span>
						res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'rememberme'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'Uid'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
						res<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">'Cooks were delete'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				 <span class="token punctuation">}</span><span class="token punctuation">,</span>        
</code></pre></div><h2 id="подкnючени-к-бд"><a href="#подкnючени-к-бд" aria-hidden="true" class="header-anchor">#</a> Подключени к БД <a id="db"></a></h2> <ul><li>заходим в config/connections.js - там есть секция MySQL и вводим свои данные для подключения</li> <li>заходим в config/models.js - там пишем название массива подключения к БД,</li> <li>и раскоментим строку - migrate: 'alter', это значит перестроение таблиц автоматом в соответствии с моделями:</li></ul> <ul><li>'alter' - перестроит таблицы, но при этом сохранит данные которые в них</li> <li>'safe'  - ничего не строит на основе моделей, надо вручную делать таблы</li> <li>'drop'  - убивает таблицы, и заново их строит</li></ul> <h2 id="шабnонизатор"><a href="#шабnонизатор" aria-hidden="true" class="header-anchor">#</a> Шаблонизатор <a id="templater"></a></h2> <h5 id="по-ум-стоит-ejs-по-жеnанию-можно-подкnючить-nюбой-шабnонизатор-ссыnка-как-подкnючить-pug-nunjucks"><a href="#по-ум-стоит-ejs-по-жеnанию-можно-подкnючить-nюбой-шабnонизатор-ссыnка-как-подкnючить-pug-nunjucks" aria-hidden="true" class="header-anchor">#</a> По ум. стоит EJS. По желанию можно подключить любой шаблонизатор(ссылка как подключить): <a href="https://github.com/Nikeweke/EXPA--NODE/blob/master/%D0%A8%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80%D1%8B.md" target="_blank" rel="noopener noreferrer">Pug, Nunjucks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <h6 id="index-ejs-2"><a href="#index-ejs-2" aria-hidden="true" class="header-anchor">#</a> index.ejs</h6> <div class="language-html extra-class"><pre class="language-html"><code>&lt;% layout('layout') -%&gt;

&lt;% script('foo.js') -%&gt;
&lt;% stylesheet('foo.css') -%&gt;

&lt;%/* TTHHAATT  CCOOMMEENNTT*/%&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>I am the  template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

&lt;% block('header', &quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>I'm in the header.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>&quot;) -%&gt;
&lt;% block('footer', &quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>I'm in the footer.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>&quot;) -%&gt;

</code></pre></div><h6 id="layout-ejs"><a href="#layout-ejs" aria-hidden="true" class="header-anchor">#</a> layout.ejs</h6> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>It's<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    &lt;%-scripts%&gt;
    &lt;%-stylesheets%&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
      &lt;%-blocks.header%&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span>
      &lt;%-body -%&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>
      &lt;%-blocks.footer%&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="маршруты-config-routes-js"><a href="#маршруты-config-routes-js" aria-hidden="true" class="header-anchor">#</a> Маршруты (config/routes.js) <a id="routes"></a></h2> <p>Можно строить маршруты 2 путями:</p> <ol><li>прописывать в routes.js</li> <li>использовать схему в url типа - localhost/контроллер/метод действия/параметры, таким же способом можна вызывать шаблоны - такое свойство прописано в config/blueprints.js - actions = true - по ум.</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Например</span>
<span class="token comment">// -&gt; controllers/UserController.js</span>
<span class="token string">'Index'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// это значит что будет вызов шаблона с таким путем -&gt; views/user/index.ejs</span>
 <span class="token punctuation">}</span>
</code></pre></div><ul><li>Можно по разному писать маршруты</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>routes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'/'</span><span class="token punctuation">:</span>       <span class="token punctuation">{</span>  view<span class="token punctuation">:</span> <span class="token string">'homepage'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'/page'</span><span class="token punctuation">:</span>   <span class="token string">'PageController.index'</span><span class="token punctuation">,</span>
  <span class="token string">'get /page'</span><span class="token punctuation">:</span>   <span class="token string">'PageController.index'</span><span class="token punctuation">,</span>
  <span class="token string">'post /page'</span><span class="token punctuation">:</span>   <span class="token string">'PageController.index'</span><span class="token punctuation">,</span>
  <span class="token string">'delete /page'</span><span class="token punctuation">:</span>   <span class="token string">'PageController.index'</span><span class="token punctuation">,</span>
  <span class="token string">'/about'</span><span class="token punctuation">:</span>  <span class="token punctuation">{</span>
                controller<span class="token punctuation">:</span> <span class="token string">'PageController'</span><span class="token punctuation">,</span>
                action<span class="token punctuation">:</span> <span class="token string">'about'</span>
              <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="в-продакшене"><a href="#в-продакшене" aria-hidden="true" class="header-anchor">#</a> В Продакшене <a id="prod"></a></h2> <ul><li>нужно в config/blueprints.js - разкомментить и поставить false : actions, rest, shortcuts</li></ul> <h2 id="request-req"><a href="#request-req" aria-hidden="true" class="header-anchor">#</a> Request(req) <a id="req"></a></h2> <ul><li><code>req.acceptedLanguages</code> - стандартные языки пользователя</li> <li><code>req.route</code> - путь маршрута</li> <li><code>req.headers</code> - заголовки</li> <li><code>req.protocol</code> - http or https, ftp , file</li></ul> <h2 id="promises-db"><a href="#promises-db" aria-hidden="true" class="header-anchor">#</a> Promises DB <a id="promises_db"></a></h2> <p>Promises для работы с БД, не <code>callbacks</code>.</p> <h6 id="indexcontroller-js"><a href="#indexcontroller-js" aria-hidden="true" class="header-anchor">#</a> IndexController.js</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">Index</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> users   <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// получаем пользователей</span>

  <span class="token comment">// эта комманда дает завершиться всем промисам, и в конце мы просто передаем данные на вьюху</span>
    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>users<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">values</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

       users   <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token string">'homepage'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>users<span class="token punctuation">:</span> users <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//  return res.ok('ss');</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h6 id="user-js"><a href="#user-js" aria-hidden="true" class="header-anchor">#</a> User.js</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">getUsers</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
    <span class="token comment">// Было так , я перенс в SQLsimple.js</span>
   <span class="token comment">// return new Promise(resolve =&gt; {</span>
   <span class="token comment">//     User.query('SELECT * FROM users', (err, result) =&gt; {</span>
   <span class="token comment">//         if(err) { console.log(err); resolve(false); }</span>
   <span class="token comment">//          resolve(result);</span>
   <span class="token comment">//      })</span>
   <span class="token comment">//  })</span>

   
    <span class="token keyword">return</span> sqls<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// вернет промис в состоянии &lt;pending&gt;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="sync-db"><a href="#sync-db" aria-hidden="true" class="header-anchor">#</a> Sync DB <a id="sync_db"></a></h2> <p>Можно делать запросы синхронными чере эту библиотеку : <code>npm i sync --save</code>;</p> <h6 id="indexcontroller-js-2"><a href="#indexcontroller-js-2" aria-hidden="true" class="header-anchor">#</a> IndexController.js</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Sync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sync'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token function-variable function">Index</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>            <span class="token comment">// == function (req, res)</span>
<span class="token punctuation">{</span>
  <span class="token function">Sync</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                      <span class="token comment">// оболочка синхронности</span>

           <span class="token keyword">var</span> result <span class="token operator">=</span> User<span class="token punctuation">.</span>getUsers<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// первым параметром идет callback, потом остальные</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">//  out: [ [users], 5 ]</span>

           res<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">'All is working fine'</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h6 id="user-js-2"><a href="#user-js-2" aria-hidden="true" class="header-anchor">#</a> User.js</h6> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function-variable function">getUsers</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">param1<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span>  <span class="token comment">// последним параметром идет callback, перед ним остальные</span>
    <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>param1<span class="token punctuation">)</span><span class="token punctuation">;</span>
          User<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">var</span> param2 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>  
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">,</span> param2<span class="token punctuation">)</span><span class="token punctuation">;</span>        
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/EXPA--Backend/node/sockets-io.html" class="prev">
          Sockets.io
        </a></span> <span class="next"><a href="/EXPA--Backend/node/adonis.html">
          AdonisJS - framework for Nodejs
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/EXPA--Backend/assets/js/app.a74ff4a4.js" defer></script><script src="/EXPA--Backend/assets/js/2.3576fb27.js" defer></script><script src="/EXPA--Backend/assets/js/20.45ed8275.js" defer></script>
  </body>
</html>
